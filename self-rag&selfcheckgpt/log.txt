❯ bash experiment.sh 
[1/6] 准备数据集...
[2/6] 使用 OpenAI 获取基线答案...
(1/5)问题: Age 21 became the uniform legal drinking age across the us in?

OpenAI回答: The uniform legal drinking age of 21 across the United States was established on **July 17, 1984**, when President Ronald Reagan signed the **National Minimum Drinking Age Act (NMDAA)** into law. This act required states to raise their minimum purchase and public possession age for alcohol to 21 or face a reduction in federal highway funds. It effectively encouraged all states to adopt the age of 21 as the legal drinking age, though some states initially resisted and phased in compliance over time.
[用时: 2.31秒]
----------------------------------------

RAG回答: Age 21 became the uniform legal drinking age across the United States in **1984** following the passage of the **National Minimum Drinking Age Act**, with all states complying by **1995**.
[用时: 1.49秒]
========================================

(2/5)问题: Who has won the most trophies man utd or liverpool?

OpenAI回答: As of October 2023, **Manchester United** and **Liverpool** are close rivals in terms of trophies won overall. However, Liverpool currently have a slight edge in total trophies. Here's a breakdown of the details:

### **Manchester United:**
- **66 major trophies** overall (including domestic and international titles)
  - **20** English League titles (most in England).
  - **12** FA Cups.
  - **6** League Cups.
  - **3** Champions League/European Cups.
  - **1** Europa League.
  - **1** FIFA Club World Cup.
  - **24** Community Shields (some shared).

### **Liverpool:**
- **70 major trophies** overall:
  - **19** English League titles.
  - **8** FA Cups.
  - **9** League Cups (record number).
  - **6** Champions League/European Cups.
  - **4** UEFA Super Cups.
  - **3** UEFA Europa Leagues.
  - **1** FIFA Club World Cup.
  - **16** Community Shields (some shared).

### Current Edge:
- Liverpool have **70 recognized trophies**, compared to United's **66 trophies**, meaning Liverpool have won more overall.

That said, these stats evolve over time, and the rivalry remains fierce, with both clubs consistently competing to add to their silverware.
[用时: 3.51秒]
----------------------------------------

RAG回答: Based on the provided context, **Manchester United have won more total trophies than Liverpool**. Additionally, Manchester United also lead Liverpool in "major" honors.
[用时: 1.23秒]
========================================

(3/5)问题: For whom was the battle of king's mountain a victory?

OpenAI回答: The Battle of King's Mountain, fought on October 7, 1780, during the American Revolutionary War, was a significant victory for the Patriot militia forces. They defeated the Loyalist forces led by British Major Patrick Ferguson in the backcountry of South Carolina. 

This victory was a turning point in the Southern Campaign of the war. It boosted Patriot morale, weakened British control in the Southern states, and discouraged Loyalist support in the region. The battle demonstrated the effectiveness of Patriot militia forces and their resolve to defend their homes from British influence.
[用时: 1.78秒]
----------------------------------------

RAG回答: The Battle of Kings Mountain was a victory for the **Patriots**.
[用时: 1.34秒]
========================================

(4/5)问题: When is dbz super episode 119 coming out?

OpenAI回答: The Dragon Ball Super series finished airing its episodes in March 2018. Episode 119, titled "A New Victim from Universe 7! Universe 4 Gets Serious!!," originally aired on **December 10, 2017**. If you're inquiring about something else, such as a continuation of the Dragon Ball Super anime, there hasn't been an official release date announced as of October 2023. Let me know if you'd like more details!
[用时: 2.38秒]
----------------------------------------

RAG回答: Based on the context provided, "Dragon Ball Super" ended on **March 25, 2018**, after completing the **"Universe Survival Saga"** at episode 131. Therefore, episode 119 has already been released, as it aired during the original run of the series. Specifically, episode 119 aired on **December 10, 2017**, as part of the series.
[用时: 1.73秒]
========================================

(5/5)问题: Who was the winner of dancing with the stars season 21?

OpenAI回答: The winner of *Dancing with the Stars* Season 21, which aired in 2015, was **Bindi Irwin**, partnered with professional dancer **Derek Hough**. Bindi, the daughter of the late Steve Irwin, captivated audiences with her performances, emotional connection, and impressive dance skills throughout the season.
[用时: 1.96秒]
----------------------------------------

RAG回答: The winner of "Dancing with the Stars" season 21 was **Bindi Irwin** and her partner **Derek Hough**.
[用时: 1.49秒]
========================================

OpenAI总耗时11.93秒，平均每样本2.39秒
RAG总耗时7.27秒，平均每样本1.45秒



[3/6] 使用 SelfRAG  获取答案...
Loading pt checkpoint shards:   0% Completed | 0/2 [00:00<?, ?it/s]
Loading pt checkpoint shards:  50% Completed | 1/2 [00:07<00:07,  7.10s/it]
Loading pt checkpoint shards: 100% Completed | 2/2 [00:09<00:00,  4.39s/it]
Loading pt checkpoint shards: 100% Completed | 2/2 [00:09<00:00,  4.79s/it]

Processed prompts: 100%|█████████████████████████████████████████████████████████| 5/5 [02:17<00:00, 27.52s/it, est. speed input: 8.66 toks/s, output: 3.67 toks/s]
(1/5)问题: Age 21 became the uniform legal drinking age across the us in?

SelfRag回答: The Uniform Drinking Age Act of 1984 was the first law to make 21 the uniform legal drinking age across the US. The law was passed by the United States Congress and signed into law by President Ronald Reagan on October 12, 1984. The law stated that if a state did not set its drinking age at 21, it w
[用时: 139.05秒]
----------------------------------------

Processed prompts: 100%|████████████████████████████████████████████████████████| 5/5 [01:08<00:00, 13.69s/it, est. speed input: 18.18 toks/s, output: 3.59 toks/s]
(2/5)问题: Who has won the most trophies man utd or liverpool?

SelfRag回答: Manchester United have won more total trophies than Liverpool, and they also lead the Merseysiders in so-called "major" honours as well. The cities of Liverpool and Manchester are located in the north west of England, apart. Since the industrial revolution there has been a consistent theme of rivalr
[用时: 68.44秒]
----------------------------------------

Processed prompts: 100%|████████████████████████████████████████████████████████| 5/5 [01:46<00:00, 21.31s/it, est. speed input: 10.29 toks/s, output: 3.62 toks/s]
(3/5)问题: For whom was the battle of king's mountain a victory?

SelfRag回答: The Battle of Kings Mountain was a victory for the Patriots, especially because it was won by militiamen and not trained Continentals. It provided a great swing of momentum for the moderate "Overmountain Men" who had grown tired of British brutality [1].
[用时: 106.57秒]
----------------------------------------

Processed prompts: 100%|████████████████████████████████████████████████████████| 5/5 [00:45<00:00,  9.13s/it, est. speed input: 26.04 toks/s, output: 3.66 toks/s]
(4/5)问题: When is dbz super episode 119 coming out?

SelfRag回答: Dragon Ball Super episode 119 came out on March 25, 2018 [1].
[用时: 45.67秒]
----------------------------------------

Processed prompts: 100%|████████████████████████████████████████████████████████| 5/5 [00:41<00:00,  8.31s/it, est. speed input: 32.26 toks/s, output: 3.80 toks/s]
(5/5)问题: Who was the winner of dancing with the stars season 21?

SelfRag回答: Season 21 of Dancing with the Stars had Bindi Irwin and her partner Derek Hough as the winners [1].
[用时: 41.58秒]
----------------------------------------

QA/asqa/eli5 已完成：总耗时 401.32s，平均每样本 80.26s
[4/6] 使用 RAGAS 对回答进行评估...
正在对 openai_answer 回答进行 RAGAS 评估...
/output/llm-illusion/ragas_eval.py:45: DeprecationWarning: LangchainLLMWrapper is deprecated and will be removed in a future version. Use the modern LLM providers instead: from ragas.llms.base import llm_factory; llm = llm_factory('gpt-4o-mini') or from ragas.llms.base import instructor_llm_factory; llm = instructor_llm_factory('openai', client=openai_client)
  evaluator_llm = LangchainLLMWrapper(llm)
Evaluating: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 15/15 [00:54<00:00,  3.66s/it]
RAGAS 评估完成，评估结果：{'context_recall': 0.1667, 'faithfulness': 0.3347, 'factual_correctness(mode=f1)': 0.3000}
耗时 57.71 秒
正在对 rag_answer 回答进行 RAGAS 评估...
/output/llm-illusion/ragas_eval.py:45: DeprecationWarning: LangchainLLMWrapper is deprecated and will be removed in a future version. Use the modern LLM providers instead: from ragas.llms.base import llm_factory; llm = llm_factory('gpt-4o-mini') or from ragas.llms.base import instructor_llm_factory; llm = instructor_llm_factory('openai', client=openai_client)
  evaluator_llm = LangchainLLMWrapper(llm)
Evaluating: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 15/15 [00:55<00:00,  3.70s/it]
RAGAS 评估完成，评估结果：{'context_recall': 0.1667, 'faithfulness': 0.7200, 'factual_correctness(mode=f1)': 0.2880}
耗时 58.25 秒
正在对 self_rag_answer 回答进行 RAGAS 评估...
Evaluating: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 15/15 [00:51<00:00,  3.40s/it]
RAGAS 评估完成，评估结果：{'context_recall': 0.1667, 'faithfulness': 0.6000, 'factual_correctness(mode=f1)': 0.2140}
耗时 54.55 秒


[5/6] 使用 SelfCheckGpt 对回答进行语句级评估...
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:00<00:00, 59.02it/s]
SelfCheck-LLMPrompt (mistralai/Mistral-7B-Instruct-v0.2) initialized to device cuda
(0/5)问题: Age 21 became the uniform legal drinking age across the us in?

正在对 openai_answer 回答进行 RAGAS 评估...
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:01<00:00,  1.58it/s]
回答包含 3 条语句，幻觉得分为：[0.33333333 0.         0.        ]
平均幻觉得分为：0.1111
正在对 rag_answer 回答进行 RAGAS 评估...
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  2.20it/s]
回答包含 1 条语句，幻觉得分为：[0.]
平均幻觉得分为：0.0000
正在对 self_rag_answer 回答进行 RAGAS 评估...
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:01<00:00,  2.20it/s]
回答包含 3 条语句，幻觉得分为：[0.         0.33333333 0.        ]
平均幻觉得分为：0.1111
(1/5)问题: Who has won the most trophies man utd or liverpool?

正在对 openai_answer 回答进行 RAGAS 评估...
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9/9 [00:04<00:00,  2.01it/s]
回答包含 9 条语句，幻觉得分为：[0.33333333 0.66666667 0.         0.66666667 0.         0.33333333
 0.         0.66666667 0.        ]
平均幻觉得分为：0.2963
正在对 rag_answer 回答进行 RAGAS 评估...
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.04it/s]
回答包含 2 条语句，幻觉得分为：[0.33333333 0.33333333]
平均幻觉得分为：0.3333
正在对 self_rag_answer 回答进行 RAGAS 评估...
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:01<00:00,  2.04it/s]
回答包含 3 条语句，幻觉得分为：[0.33333333 0.         0.        ]
平均幻觉得分为：0.1111
(2/5)问题: For whom was the battle of king's mountain a victory?

正在对 openai_answer 回答进行 RAGAS 评估...
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 5/5 [00:02<00:00,  2.23it/s]
回答包含 5 条语句，幻觉得分为：[0. 0. 0. 0. 0.]
平均幻觉得分为：0.0000
正在对 rag_answer 回答进行 RAGAS 评估...
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  2.51it/s]
回答包含 1 条语句，幻觉得分为：[0.]
平均幻觉得分为：0.0000
正在对 self_rag_answer 回答进行 RAGAS 评估...
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:01<00:00,  2.24it/s]
回答包含 3 条语句，幻觉得分为：[0.         0.         0.33333333]
平均幻觉得分为：0.1111
(3/5)问题: When is dbz super episode 119 coming out?

正在对 openai_answer 回答进行 RAGAS 评估...
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 5/5 [00:02<00:00,  2.21it/s]
回答包含 5 条语句，幻觉得分为：[0.         0.         0.33333333 0.         0.        ]
平均幻觉得分为：0.0667
正在对 rag_answer 回答进行 RAGAS 评估...
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:01<00:00,  2.22it/s]
回答包含 3 条语句，幻觉得分为：[0.66666667 0.         0.33333333]
平均幻觉得分为：0.3333
正在对 self_rag_answer 回答进行 RAGAS 评估...
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.19it/s]
回答包含 2 条语句，幻觉得分为：[0.66666667 0.66666667]
平均幻觉得分为：0.6667
(4/5)问题: Who was the winner of dancing with the stars season 21?

正在对 openai_answer 回答进行 RAGAS 评估...
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2/2 [00:00<00:00,  2.25it/s]
回答包含 2 条语句，幻觉得分为：[0. 0.]
平均幻觉得分为：0.0000
正在对 rag_answer 回答进行 RAGAS 评估...
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  2.26it/s]
回答包含 1 条语句，幻觉得分为：[0.]
平均幻觉得分为：0.0000
正在对 self_rag_answer 回答进行 RAGAS 评估...
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  2.25it/s]
回答包含 1 条语句，幻觉得分为：[0.]
平均幻觉得分为：0.0000


[6/6] 可视化结果...
数据概览:
总问题数: 5
总记录数: 15

模型分布:
model
openai      5
rag         5
self_rag    5
Name: count, dtype: int64

=== 响应时间分析 ===

=== 评估指标分析 ===

=== 幻觉分数分析 ===
/output/llm-illusion/visualize.py:159: MatplotlibDeprecationWarning: The 'labels' parameter of boxplot() has been renamed 'tick_labels' since Matplotlib 3.9; support for the old name will be dropped in 3.11.
  axes[0,1].boxplot(all_scores, labels=labels)

=== 综合性能分析 ===

=== 相关性分析 ===

=== 生成详细统计表格 ===

=== 生成分析报告 ===

=== 生成汇总仪表板 ===


=== 分析完成 ===
所有图表和表格已保存到 'visualization_analysis' 文件夹
共生成文件:
- 6个分析图表
- 3个统计表格
- 1份分析报告
- 1个汇总仪表板

关键统计结果:
平均响应时间: {'openai': 2.387, 'rag': 1.455, 'self_rag': 80.262}
平均事实正确性: {'openai': 0.3, 'rag': 0.288, 'self_rag': 0.214}
平均幻觉分数: {'openai': 0.139, 'rag': 0.208, 'self_rag': 0.194}
实验完成！
图表结果已保存至 visualization_analysis 文件夹
原始数据已保存至 experiment_file.json
